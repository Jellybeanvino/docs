---
title: Manage an Endpoint
summary: Learn how to create, develop, test, deploy, and delete an endpoint in a Data App in the TiDB Cloud console.
---

# エンドポイントの管理 {#manage-an-endpoint}

Data Service (ベータ) のエンドポイントは、SQL ステートメントを実行するようにカスタマイズできる Web API です。 `WHERE`句で使用される値など、SQL ステートメントのパラメータを指定できます。クライアントがエンドポイントを呼び出し、リクエスト URL 内のパラメータの値を指定すると、エンドポイントは指定されたパラメータを使用して SQL ステートメントを実行し、結果を HTTP 応答の一部として返します。

このドキュメントでは、 TiDB Cloudコンソールのデータ アプリでエンドポイントを管理する方法について説明します。

## あなたが始める前に {#before-you-begin}

エンドポイントを管理する前に、クラスターとデータ アプリを作成していることを確認してください。詳細については、 [データアプリを作成する](/tidb-cloud/data-service-manage-data-app.md#create-a-data-app)を参照してください。

エンドポイントを呼び出す前に、データ アプリで API キーを作成していることを確認してください。詳細については、 [APIキーを作成する](/tidb-cloud/data-service-api-key.md#create-an-api-key)を参照してください。

## エンドポイントを作成する {#create-an-endpoint}

エンドポイントを作成するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左側のペインで、ターゲットのデータ アプリを見つけて、アプリ名の右側にある**[+****エンドポイントの作成]**をクリックします。必要に応じて、デフォルト名を更新できます。

    > **ヒント：**
    >
    > または、データ アプリを見つけて、左ペインの上部にある**[+****エンドポイントの作成]**をクリックすることもできます。

3.  新しく作成されたエンドポイントがエンドポイント リストの先頭に追加されます。

Chat2Query (ベータ版) では、SQL ファイルからエンドポイントを作成することもできます。詳細については、 [SQL ファイルからエンドポイントを生成する](/tidb-cloud/explore-data-with-chat2query.md#generate-an-endpoint-from-a-sql-file)を参照してください。

## エンドポイントを開発する {#develop-an-endpoint}

エンドポイントごとに、TiDB クラスター上で実行する SQL ステートメントを作成したり、SQL ステートメントのパラメーターを定義したり、名前とバージョンを管理したりできます。

> **ノート：**
>
> **自動同期とデプロイを**有効にしてデータ アプリを GitHub に接続している場合は、GitHub を使用してエンドポイント構成を更新することもできます。 GitHub で行った変更はすべてTiDB Cloudに自動的にデプロイされます。詳細については、 [GitHub を使用して自動的にデプロイ](/tidb-cloud/data-service-manage-github-connection.md)を参照してください。

### プロパティの構成 {#configure-properties}

エンドポイントの詳細ページの右側のペインで、 **「プロパティ」**タブをクリックして、エンドポイントの次のプロパティを表示および管理できます。

-   **エンドポイント パス**: ユーザーがアクセスするために使用するエンドポイントの一意のパス。

    -   パスはデータ アプリ内で一意である必要があります。
    -   パスには文字、数字、アンダースコア ( `_` )、およびスラッシュ ( `/` ) のみを使用できます。パスはスラッシュ ( `/` ) で始まり、文字、数字、またはアンダースコア ( `_` ) で終わる必要があります。たとえば、 `/my_endpoint/get_id` 。
    -   パスの長さは 64 文字未満である必要があります。

-   **エンドポイント URL** : (読み取り専用) URL は、対応するクラスターが配置されているリージョン、データ アプリのサービス URL、およびエンドポイントのパスに基づいて自動的に生成されます。たとえば、エンドポイントのパスが`/my_endpoint/get_id`の場合、エンドポイント URL は`https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/my_endpoint/get_id`です。

-   **リクエストメソッド**: エンドポイントの HTTP メソッド。次のメソッドがサポートされています。

    -   `GET` : このメソッドを使用して、 `SELECT`ステートメントなどのデータをクエリします。
    -   `POST` : このメソッドは、 `INSERT`ステートメントなどのデータを挿入するために使用します。

-   **Timeout(ms)** : エンドポイントのタイムアウト。

    -   デフォルト値: `5000`
    -   最大値： `30000`
    -   最小値: `1`
    -   単位：ミリ秒

-   **Max Rows** : エンドポイントが返す最大行数。

    -   デフォルト値: `50`
    -   最大値： `2000`
    -   最小値: `1`

-   **説明**(オプション): エンドポイントの説明。

### SQL ステートメントを作成する {#write-sql-statements}

エンドポイントの詳細ページの SQL エディターで、エンドポイントの SQL ステートメントを作成して実行できます。 `--`に続けて指示を入力するだけで、AI に SQL ステートメントを自動的に生成させることもできます。

1.  クラスターを選択します。

    > **ノート：**
    >
    > データ アプリにリンクされているクラスターのみがドロップダウン リストに表示されます。リンクされたクラスターを管理するには、 [リンクされたクラスターを管理する](/tidb-cloud/data-service-manage-data-app.md#manage-linked-data-sources)を参照してください。

    SQL エディターの上部で、SQL ステートメントを実行するクラスターをドロップダウン リストから選択します。その後、右側のペインの**[スキーマ]**タブで、このクラスターのすべてのデータベースを表示できます。

2.  SQL ステートメントを作成します。

    データをクエリまたは変更する前に、まず SQL ステートメントでデータベースを指定する必要があります。たとえば、 `USE database_name;` 。

    SQL エディターでは、テーブル結合クエリ、複雑なクエリ、集計関数のステートメントを作成できます。 `--`に続けて指示を入力するだけで、AI に SQL ステートメントを自動的に生成させることもできます。

    パラメーターを定義するには、SQL ステートメントに`${ID}`のような変数プレースホルダーとして挿入します。たとえば、 `SELECT * FROM table_name WHERE id = ${ID}` 。次に、右側のペインの**「Params」**タブをクリックして、パラメータ定義とテスト値を変更できます。詳細については、 [パラメーター](#configure-parameters)を参照してください。

    > **ノート：**
    >
    > -   パラメータ名では大文字と小文字が区別されます。
    > -   このパラメーターをテーブル名または列名として使用することはできません。

3.  SQL ステートメントを実行します。

    SQL ステートメントにパラメータを挿入した場合は、右側のペインの**[パラメータ]**タブでパラメータのテスト値またはデフォルト値を設定していることを確認してください。それ以外の場合は、エラーが返されます。

    SQL ステートメントを実行するには、カーソルで SQL の行を選択し、 **「実行」** &gt; **「カーソル位置で実行」**をクリックします。

    SQL エディターですべての SQL ステートメントを実行するには、 **「実行」**をクリックします。この場合、最後の SQL 結果のみが返されます。

    ステートメントを実行すると、ページ下部の**[結果]**タブにクエリ結果がすぐに表示されます。

### パラメータを設定する {#configure-parameters}

エンドポイントの詳細ページの右側のペインで、 **「パラメータ」**タブをクリックして、エンドポイントで使用されるパラメータを表示および管理できます。

**「定義」**セクションでは、パラメータの次のプロパティを表示および管理できます。

-   パラメータ名: 名前には文字、数字、アンダースコア ( `_` ) のみを含めることができ、文字またはアンダースコア ( `_` ) で始める必要があります。
-   **Required** : リクエストでパラメータが必須かどうかを指定します。デフォルトの構成は不要に設定されています。
-   **Type** : パラメータのデータ型を指定します。サポートされている値は`STRING` 、 `NUMBER` 、および`BOOLEAN`です。 `STRING`型のパラメータを使用する場合は、引用符 ( `'`または`"` ) を追加する必要はありません。たとえば、 `foo` `STRING`タイプに対して有効であり、 `"foo"`として処理されますが、 `"foo"` `"\"foo\""`として処理されます。
-   **デフォルト値**: パラメータのデフォルト値を指定します。

    -   値がパラメータの型に変換できることを確認してください。それ以外の場合、エンドポイントはエラーを返します。
    -   パラメーターのテスト値を設定しない場合、エンドポイントのテスト時にデフォルト値が使用されます。

**「テスト値」**セクションでは、テストパラメータを表示および設定できます。これらの値は、エンドポイントをテストするときにパラメーター値として使用されます。値がパラメータの型に変換できることを確認してください。それ以外の場合、エンドポイントはエラーを返します。

### バージョンの管理 {#manage-versions}

エンドポイントの詳細ページの右側のペインで、 **「デプロイメント」**タブをクリックして、エンドポイントのデプロイされたバージョンを表示および管理できます。

**[展開]**タブでは、ドラフト バージョンを展開したり、オンライン バージョンを展開解除したりできます。

### 名前の変更 {#rename}

エンドポイントの名前を変更するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  名前を変更するエンドポイントを見つけて、 **[...]** &gt; **[名前の変更**] をクリックし、エンドポイントの新しい名前を入力します。

## エンドポイントをテストする {#test-an-endpoint}

エンドポイントをテストするには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  テストするエンドポイントの名前をクリックして、その詳細を表示します。

4.  (オプション) エンドポイントにパラメータが含まれている場合は、テスト前にテスト値を設定する必要があります。

    1.  エンドポイントの詳細ページの右側のペインで、 **「Params」**タブをクリックします。
    2.  **「テスト値」**セクションを展開し、パラメータのテスト値を設定します。

        パラメータのテスト値を設定しない場合は、デフォルト値が使用されます。

5.  右上隅の**「テスト」**をクリックします。

    > **ヒント：**
    >
    > あるいは、 <kbd>F5 キー</kbd>を押してエンドポイントをテストすることもできます。

エンドポイントをテストした後、ページの下部に応答が JSON として表示されます。 JSON 応答の詳細については、 [エンドポイントの応答](#response)を参照してください。

## エンドポイントをデプロイ {#deploy-an-endpoint}

> **ノート：**
>
> **自動同期とデプロイメントを**有効にしてデータ アプリを GitHub に接続している場合、GitHub で行ったデータ アプリの変更はすべてTiDB Cloudに自動的にデプロイされます。詳細については、 [GitHub を使用して自動的にデプロイ](/tidb-cloud/data-service-manage-github-connection.md)を参照してください。

エンドポイントをデプロイするには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  デプロイするエンドポイントを見つけ、エンドポイント名をクリックして詳細を表示し、右上隅にある**[デプロイ]**をクリックします。
4.  データ アプリで**[ドラフトの確認]**が有効になっている場合は、行った変更を確認するためのダイアログが表示されます。レビューに基づいて変更を破棄するかどうかを選択できます。
5.  **「デプロイ」**をクリックしてデプロイメントを確認します。**エンドポイントが正常にデプロイされる**と、「エンドポイントがデプロイされました」というプロンプトが表示されます。

    エンドポイントの詳細ページの右側のペインで、 **「デプロイメント」**タブをクリックすると、デプロイされた履歴を表示できます。

## エンドポイントを呼び出す {#call-an-endpoint}

エンドポイントを呼び出すには、エンドポイントの未デプロイのドラフト バージョンまたはデプロイされたオンライン バージョンのいずれかに HTTPS リクエストを送信できます。

### 前提条件 {#prerequisites}

エンドポイントを呼び出す前に、API キーを作成する必要があります。詳細については、 [APIキーを作成する](/tidb-cloud/data-service-api-key.md#create-an-api-key)を参照してください。

### リクエスト {#request}

TiDB Cloudは、エンドポイントの呼び出しに役立つコード サンプルを生成します。コード例を取得するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。

2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。

3.  呼び出したいエンドポイントを見つけて、 **[...]** &gt; **[コード例]**をクリックします。 **[コード例]**ダイアログ ボックスが表示されます。

    > **ヒント：**
    >
    > または、エンドポイント名をクリックして詳細を表示し、右上隅の**[...]** &gt; **[コード例]**をクリックすることもできます。

4.  ダイアログ ボックスで、エンドポイントの呼び出しに使用するクラスターとデータベースを選択し、コード例をコピーします。

    > **ノート：**
    >
    > -   コード例は、エンドポイントのプロパティとパラメーターに基づいて生成されます。
    > -   オンライン環境は、エンドポイントを展開した後にのみ使用可能になります。
    > -   現在、 TiDB Cloud、curl コード サンプルのみが提供されています。

    Curl コード例の例は次のとおりです。

    <SimpleTab>
     <div label="Test Environment">

    エンドポイントのドラフト バージョンを呼び出すには、 `endpoint-type: draft`ヘッダーを追加する必要があります。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>' \
      --header 'endpoint-type: draft'
    ```

    </div>

    <div label="Online Environment">

    オンライン環境でコード例を確認する前に、まずエンドポイントをデプロイする必要があります。

    現在のオンライン バージョンのエンドポイントを呼び出すには、次のコマンドを使用します。

    ```bash
    curl --digest --user '<Public Key>:<Private Key>' \
      --request GET 'https://<region>.data.tidbcloud.com/api/v1beta/app/<App ID>/endpoint/<Endpoint Path>'
    ```

    </div>
     </SimpleTab>

    > **ノート：**
    >
    > -   リージョン ドメイン`<region>.data.tidbcloud.com`をリクエストすると、TiDB クラスターが配置されているリージョンのエンドポイントに直接アクセスできます。
    > -   あるいは、リージョンを指定せずにグローバル ドメイン`data.tidbcloud.com`をリクエストすることもできます。この方法で、 TiDB Cloudはリクエストを内部的にターゲット リージョンにリダイレクトしますが、これにより追加のレイテンシーが発生する可能性があります。この方法を選択した場合は、エンドポイントを呼び出すときに必ず`--location-trusted`オプションをcurl コマンドに追加してください。

5.  コード例をアプリケーションに貼り付けて実行します。

    -   `<Public Key>`と`<Private Key>`プレースホルダーを API キーに置き換える必要があります。詳細については、 [APIキーを管理する](/tidb-cloud/data-service-api-key.md)を参照してください。
    -   エンドポイントにパラメーターが含まれている場合は、エンドポイントを呼び出すときにパラメーター値を指定します。

### 応答 {#response}

エンドポイントを呼び出した後、JSON 形式で応答を確認できます。詳細については、 [データサービスのレスポンスコードとステータスコード](/tidb-cloud/data-service-response-and-status-code.md)を参照してください。

## エンドポイントのデプロイを解除する {#undeploy-an-endpoint}

> **ノート：**
>
> **自動同期とデプロイが**有効になっている[データ アプリを GitHub に接続しました](/tidb-cloud/data-service-manage-github-connection.md)がある場合、このデータ アプリのエンドポイントのデプロイを解除すると、GitHub 上のこのエンドポイントの構成も削除されます。

エンドポイントのデプロイを解除するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  デプロイを解除するエンドポイントを見つけて、 **[...]** &gt; **[アンデプロイ]**をクリックします。
4.  **「アンデプロイ」**をクリックしてアンデプロイを確認します。

## エンドポイントを削除する {#delete-an-endpoint}

> **ノート：**
>
> エンドポイントを削除する前に、エンドポイントがオンラインでないことを確認してください。そうしないと、エンドポイントを削除できません。エンドポイントのデプロイを解除するには、 [エンドポイントのデプロイを解除する](#undeploy-an-endpoint)を参照してください。

エンドポイントを削除するには、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/console/data-service)ページに移動します。
2.  左側のペインで、ターゲット データ アプリの名前をクリックして、そのエンドポイントを表示します。
3.  削除するエンドポイントの名前をクリックし、右上隅にある**[...]** &gt; **[削除]**をクリックします。
4.  **「削除」を**クリックして削除を確認します。
